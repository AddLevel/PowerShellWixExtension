<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" xmlns:powershell="http://schemas.gardiner.net.au/PowerShellWixExtensionSchema">

  <?define BuildVersion = 1.0.0.0 ?>
  <?define Company      = "AddLevel" ?>
  <?define UpgradeCode  = "fee1cf6a-5425-4c89-8c4d-0bb690ad9483" ?>
  
  <?if $(var.Platform)=x64 ?>

  <?else?>
  
  <?endif?>

  <Product Id="*"
           Name="!(loc.ProductName_$(var.Platform))"
           Language="!(loc.Language)"
           Version="$(var.BuildVersion)"
           Manufacturer="$(var.Company)"
           UpgradeCode="$(var.UpgradeCode)">

    <Package InstallerVersion="200"
             Compressed="yes"
             InstallScope="perMachine"
             Platform="x64"/>

    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />

    <MediaTemplate EmbedCab="yes" />

    <?include Directories.wxi?>
    <?include Features.wxi?>
    <?include scripts\PSScriptFiles.wxi?>
    <?include datascripts\PSScriptData.wxi?>

    <!-- Condition Message="Test condition">
      <![CDATA[Installed]]>
    </Condition-->

    <!--UI>
      <TextStyle Id="WixUI_Font_Normal" FaceName="Tahoma" Size="8" />
      <TextStyle Id="WixUI_Font_Bigger" FaceName="Tahoma" Size="12" />
      <TextStyle Id="WixUI_Font_Title" FaceName="Tahoma" Size="9" Bold="yes" />

      <Property Id="DefaultUIFont" Value="WixUI_Font_Normal" />
      <Property Id="WixUI_Mode" Value="Minimal" />

      <DialogRef Id="ErrorDlg" />
      <DialogRef Id="FatalError" />
      <DialogRef Id="FilesInUse" />
      <DialogRef Id="ProgressDlg" />
      <DialogRef Id="UserExit" />

      <Publish Dialog="ExitDialog" Control="Finish" Event="EndDialog" Value="Return" Order="999">1</Publish>

      <Property Id="ARPNOMODIFY" Value="1" />
    </UI-->

    <UIRef Id="WixUI_Mondo" />

    <InstallExecuteSequence>

      <!-- These are the 'immediate' actions that prep the data for the 'deferred' actions-->
      <Custom Action="PowerShellScriptsImmediate" Before="PowerShellScriptsDeferred">Installed</Custom>
      <Custom Action="PowerShellScriptsElevatedImmediate" Before="PowerShellScriptsElevatedDeferred">Installed</Custom>

      <!-- 'Deferred' actions -->
      <Custom Action="PowerShellScriptsDeferred" Before="RemoveFiles">Installed</Custom>
      <Custom Action="PowerShellScriptsElevatedDeferred" Before="RemoveFiles">Installed</Custom>

    </InstallExecuteSequence>

  </Product>

	<Fragment> 
		<ComponentGroup Id="SetupFiles" Directory="SETUP">
      <Component Id="Install" Win64="yes">
        <File Id="SetupPs1" Source="scripts\setup.ps1" KeyPath="yes" Hidden="yes"/>
      </Component>
      <Component Id="Uninstall" Win64="yes">
        <File Id="UninstallPs1" Source="scripts\uninstall.ps1" KeyPath="yes" Hidden="yes"/>
      </Component>
		</ComponentGroup>
	</Fragment>

</Wix>
